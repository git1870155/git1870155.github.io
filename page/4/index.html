<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>A type of habit</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="private blog">
<meta property="og:type" content="website">
<meta property="og:title" content="A type of habit">
<meta property="og:url" content="jiweii.com/page/4/index.html">
<meta property="og:site_name" content="A type of habit">
<meta property="og:description" content="private blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A type of habit">
<meta name="twitter:description" content="private blog">
  
    <link rel="alternate" href="/atom.xml" title="A type of habit" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/favicon.ico">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">A type of habit</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="jiweii.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-浅拷贝与深拷贝" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/07/浅拷贝与深拷贝/" class="article-date">
  <time datetime="2017-02-07T11:34:13.000Z" itemprop="datePublished">2017-02-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">php</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/07/浅拷贝与深拷贝/">浅拷贝与深拷贝</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>对象的赋值分为浅拷贝与深拷贝，
区别在于浅拷贝为新对象与原来的指向同一个地址，如果新对象属性改变，原有对象也会跟着改变，
深拷贝为整体复制一份对象，与地址无关&lt;!--more--&gt;</p>
<h2>浅拷贝</h2>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">public</span> $name = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> $obj = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A();</span><br><span class="line"></span><br><span class="line">$b = $a;</span><br><span class="line"></span><br><span class="line">$b-&gt;age = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">var_dump($a-&gt;age);<span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure></p>
<p>&lt;br&gt;</p>
<h2>深拷贝</h2>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> $age = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">public</span> $name = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> $obj = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = <span class="keyword">new</span> A();</span><br><span class="line"></span><br><span class="line">$b = <span class="keyword">clone</span> $a;</span><br><span class="line"></span><br><span class="line">$b-&gt;age = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">var_dump($a-&gt;age);<span class="keyword">exit</span>;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="jiweii.com/2017/02/07/浅拷贝与深拷贝/" data-id="cjvdqd6wy002wo4r3o11iagjn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-static及延迟绑定" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/07/static及延迟绑定/" class="article-date">
  <time datetime="2017-02-07T08:24:25.000Z" itemprop="datePublished">2017-02-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">php</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/07/static及延迟绑定/">static及延迟绑定</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>static关键字用来定义静态方法及属性，在类中可用来延迟静态绑定以及在函数中修饰变量。
先来谈谈static在函数中的用法；&lt;!--more--&gt;
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    <span class="keyword">static</span> $a = <span class="number">0</span>;  </span><br><span class="line">    <span class="keyword">echo</span> $a,<span class="string">"&lt;br /&gt;"</span>;  </span><br><span class="line">    $a++;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>static的作用保证$a变量只有在add()第一次调用时才会被初始化，但需要注意的是定义static变量的时候，可以不赋初值，可以给定初值，但是赋初值的时候不能使用表达式或者调用函数赋值，否则会报错。</p>
<p>另外一点需要注意的即是static变量不会存储引用，如下：
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_obj_ref</span><span class="params">()</span></span>&#123;  </span><br><span class="line">     <span class="keyword">static</span> $obj = <span class="keyword">null</span>;  </span><br><span class="line">     <span class="keyword">echo</span> <span class="string">'Ststic obj:'</span>,<span class="string">"&lt;br /&gt;"</span>;  </span><br><span class="line">     var_dump($obj);  </span><br><span class="line">     <span class="keyword">if</span>(is_null($obj))&#123;  </span><br><span class="line">         $obj = &amp;<span class="keyword">new</span> stdClass();  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="keyword">return</span> $obj;  </span><br><span class="line">       </span><br><span class="line"> &#125;  </span><br><span class="line"> $obj = get_obj_ref();  </span><br><span class="line"> $obj2 = get_obj_ref();  </span><br><span class="line">   </span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">get_obj_noref</span><span class="params">()</span></span>&#123;  </span><br><span class="line">     <span class="keyword">static</span> $obj = <span class="keyword">null</span>;  </span><br><span class="line">     <span class="keyword">echo</span> <span class="string">'Ststic obj:'</span>,<span class="string">"&lt;br /&gt;"</span>;  </span><br><span class="line">     var_dump($obj);  </span><br><span class="line">     <span class="keyword">if</span>(is_null($obj))&#123;  </span><br><span class="line">         $obj = <span class="keyword">new</span> stdClass();  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="keyword">return</span> $obj;  </span><br><span class="line"> &#125;  </span><br><span class="line"> $obj = get_obj_noref();  </span><br><span class="line"> $obj2 = get_obj_noref();</span><br></pre></td></tr></table></figure></p>
<p>当static存储引用时，二次调用函数后，该变量的值并未被保存下来，且运行上面程序会报Deprecated错误，即返回引用值赋值的用法已弃.</p>
<h2>静态延迟绑定</h2>
<p>延迟静态绑定是指允许在一个静态继承的上下文中引用被调用类
延迟绑定的意思为：static::不再为定义当前方法所在的类，而是实际运行时所在的类。
除了简单的static延迟绑定的用法，还有一种转发调用，即使用self::，parent::，static:: 以及forward_static_call()(该函数只能在方法中调用)将转发调用信息
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">static</span>::who();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">who</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>.<span class="string">"\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        A::foo();  </span><br><span class="line">        <span class="keyword">parent</span>::foo();  </span><br><span class="line">        <span class="keyword">self</span>::foo();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">who</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>.<span class="string">"\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">B</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">who</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>.<span class="string">"\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">C::test();</span><br></pre></td></tr></table></figure></p>
<p>这里得到的结果是A C C，显然在调用parent::foo()时，还是使用了运行时调用类。
还有一点需要注意的是：只有显示声明的static类才是从属与子类的。
<a href="http://www.phpchina.com/portal.php?mod=view&amp;aid=40048" target="_blank" rel="noopener">参考资料</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="jiweii.com/2017/02/07/static及延迟绑定/" data-id="cjvdqd6wc0022o4r3dty7fwtl" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-详解EXPLAIN的用法" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/02/03/详解EXPLAIN的用法/" class="article-date">
  <time datetime="2017-02-03T07:43:05.000Z" itemprop="datePublished">2017-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/02/03/详解EXPLAIN的用法/">详解EXPLAIN用法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>explain显示了数据库处理select语句以及连接表时使用的索引情况，可以帮助选择更好的索引和写出更优化的查询语句。
如下一条sql语句，&lt;!--more--&gt;
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select a.no,a.amount,o.company,u.realname from fk_cd_app a left join fk_cd_contract_order o on a.id=o.aid left join fk_users u on a.creator=u.id where 1 and a.id=4890;</span><br></pre></td></tr></table></figure></p>
<p>用explain解析结果为：
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+----+------------+-------+-------+---------------+---------+------------+----------+-----+------+ </span><br><span class="line">id   | select_type|  table|   type|  possible_keys|      key|     key_len|       ref| rows| Extra|</span><br><span class="line">1    |      SIMPLE|      a|  const|        PRIMARY|  PRIMARY|           4|     const|    1|      |</span><br><span class="line">1    |      SIMPLE|      o|    ref|      index_aid|index_aid|           4|     const|    1|      |</span><br><span class="line">1    |      SIMPLE|      u| eq_ref|        PRIMARY|  PRIMARY|           4|     const|    1|      |</span><br><span class="line">+----+------------+-------+-------+---------------+---------+------------+----------+-----+------+</span><br></pre></td></tr></table></figure></p>
<p>&lt;br&gt;</p>
<h2>id</h2>
<p>SELECT识别符。这是SELECT查询序列号。这个不重要,查询序号即为sql语句执行的顺序，若有子表的话则子表先查询</p>
<p>&lt;br&gt;</p>
<h2>select_type</h2>
<p>select类型，它有以下几种值:</p>
<ul>
<li>simple 它表示简单的select,没有union和子查询</li>
<li>primary 最外面的select,在有子查询的语句中，最外面的select查询就是primary</li>
<li>union union语句的第二个或者说是后面那一个</li>
<li>dependent union UNION中的第二个或后面的SELECT语句，取决于外面的查询</li>
<li>union result UNION的结果</li>
</ul>
<p>&lt;br&gt;</p>
<h2>table</h2>
<p>输出的行所用的表</p>
<p>&lt;br&gt;</p>
<h2>type</h2>
<p>连接类型。有多个参数</p>
<ul>
<li>system 表仅有一行，这是const类型的特列</li>
<li>const 表最多有一个匹配行，const用于比较primary key 或者unique索引。因为只匹配一行数据，所以很快
记住一定是用到primary key 或者unique，并且只检索出两条数据的 情况下才会是const</li>
<li>eq_ref 对于每个来自于前面的表的行组合，从该表中读取一行。这可能是最好的联接类型，除了const类型。它用在一个索引的所有部分被联接使用并且索引是UNIQUE或PRIMARY KEY</li>
<li>ref 对于每个来自于前面的表的行组合，所有有匹配索引值的行将从这张表中读取。如果联接只使用键的最左边的前缀，或如果键不是UNIQUE或PRIMARY KEY（换句话说，如果联接不能基于关键字选择单个行的话），则使用ref。如果使用的键仅仅匹配少量行，该联接类型是不错的</li>
<li>ref_or_null 该联接类型如同ref，但是添加了MySQL可以专门搜索包含NULL值的行。在解决子查询中经常使用该联接类型的优化</li>
<li>index_merge 该联接类型表示使用了索引合并优化方法。在这种情况下，key列包含了使用的索引的清单，key_len包含了使用的索引的最长的关键元素。</li>
<li>unique_subquery</li>
<li>index_subquery</li>
<li>range 给定范围内的检索，使用一个索引来检查行</li>
</ul>
<p>&lt;br&gt;</p>
<h2>possible_keys</h2>
<p>提示使用哪个索引会在该表中找到行</p>
<p>&lt;br&gt;</p>
<h2>key</h2>
<p>MYSQL使用的索引</p>
<p>&lt;br&gt;</p>
<h2>key_len</h2>
<p>MYSQL使用的索引长度</p>
<p>&lt;br&gt;</p>
<h2>ref</h2>
<p>ref列显示使用哪个列或常数与key一起从表中选择行。</p>
<p>&lt;br&gt;</p>
<h2>rows</h2>
<p>显示MYSQL执行查询的行数，数值越大越不好，说明没有用好索引</p>
<p>&lt;br&gt;</p>
<h2>Extra</h2>
<p>该列包含MySQL解决查询的详细信息.</p>
<ul>
<li>Distinct</li>
<li>Not exists</li>
<li>range checked for each record</li>
<li>using filesort</li>
<li>using index</li>
<li>using temporary</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="jiweii.com/2017/02/03/详解EXPLAIN的用法/" data-id="cjvdqd6x10031o4r302qcvafh" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-数据库表拆分" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/13/数据库表拆分/" class="article-date">
  <time datetime="2017-01-13T14:01:55.000Z" itemprop="datePublished">2017-01-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/13/数据库表拆分/">数据库表拆分</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>数据库表拆分大体分为垂直拆分与水平拆分，具体如下：&lt;!--more--&gt;
&lt;br&gt;</p>
<h2>垂直拆分</h2>
<p>顾名思义，垂直拆分就是把表垂直着拆掉
打个比方，如果一个表有如下字段
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------+---------+--------+--------+-------+---------+---------+--------+-----+-------------+--------+-----------+------+--------+ </span><br><span class="line">| userid | groupid | areaid | amount | point | modelid | message | islock | vip | overduedate | siteid | connectid | from | mobile | </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+--------+-----+-------------+--------+-----------+------+--------+</span><br></pre></td></tr></table></figure></p>
<p>比如说一个用户表有很多的属性,关联了很多数据,如果放到同一个表里面的话查询是方便了,但是效率不行,所以这里就是用到了垂直拆表:
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------+---------+--------+--------+-------+---------+---------+</span><br><span class="line">| userid | groupid | areaid | amount | point | modelid | message |</span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+</span><br></pre></td></tr></table></figure></p>
<p>和
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+--------+--------+-----+-------------+--------+-----------+------+--------+ </span><br><span class="line">| userid | islock | vip | overduedate | siteid | connectid | from | mobile | </span><br><span class="line">+--------+--------+-----+-------------+--------+-----------+------+--------+</span><br></pre></td></tr></table></figure></p>
<p>把常用的字段放一个表,不常用的放一个表
把字段比较大的比如text的字段拆出来放一个表里面
使用的话是根据具体业务来拆,查询时使用多表联查,可以再配合redis存储</p>
<p>&lt;br&gt;</p>
<h2>水平拆分</h2>
<p>顾名思义是将表数据水平的拆掉,
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">表0 user_0 </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">| userid | groupid | areaid | amount | point | modelid | message | </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">|      1 |       5 |      0 |   0.00 |    50 |      10 |       0 |   </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">表1 user_1 </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">| userid | groupid | areaid | amount | point | modelid | message | </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">|      1 |       5 |      0 |   0.00 |    50 |      10 |       0 |   </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">表2 user_2 </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">| userid | groupid | areaid | amount | point | modelid | message | </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">|      1 |       5 |      0 |   0.00 |    50 |      10 |       0 |   </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">. </span><br><span class="line">. </span><br><span class="line">. </span><br><span class="line">表9 user_9 </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">| userid | groupid | areaid | amount | point | modelid | message | </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+ </span><br><span class="line">|      1 |       5 |      0 |   0.00 |    50 |      10 |       0 |   </span><br><span class="line">+--------+---------+--------+--------+-------+---------+---------+</span><br></pre></td></tr></table></figure></p>
<p>当然这里不一定要0-9一共10张表来表示,通常情况下使用&quot;取模&quot;的形式来将数据进行表的存储,如果用4张表那么就是id%4 结果会是0,1,2,3四种,user_0,user_1,user_2,user_3就够了,具体这里就要看表的数据量了.
对水平分表的数据进行CURD操作也是一样,之前根据id取模算出当前数据在哪张表中,然后再select * from user_&quot;取的模&quot;,这里有人要问了,我添加数据之前都不知道数据库的id,更不能进行取模了,怎么找到对应的表添加啊,对了,这里就需要一张临时表,临时表的作用就是提供数据插入的自增id,得到自增id后再通过取模进行分表插入.
水平分表的表结构是一样的,只是去掉了自增的属性.</p>
<p>这里不得不说水平分表的另一种形式,就是不是通过取模计算的分表,而是user_0存数10w条数据,存满创建新表user_1,继续存储在user_1,存满创建user_2一直存储并新建下去,个人建议这种分表使用场景是user_1的数据为历史数据,访问需求量会慢慢减小,而新表的数据访问量是很高的.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="jiweii.com/2017/01/13/数据库表拆分/" data-id="cjvdqd6ww002to4r3z3ilxomq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据库/">数据库</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-php设计模式浅析-二" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/08/php设计模式浅析-二/" class="article-date">
  <time datetime="2017-01-08T08:22:07.000Z" itemprop="datePublished">2017-01-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">php</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/08/php设计模式浅析-二/">php设计模式浅析(二)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>php设计模式浅析下半段，因博客太长，所以分为两个博客
之前写的设计模式包括单例，工厂，注册数，适配器等都是平时常用或常见的，接下来的几个会是代码设计时很独特的设计模式确不怎么常用&lt;!--more--&gt;
&lt;center&gt;直达快车   &lt;a href=&quot;#策略模式&quot;&gt;策略模式&lt;/a&gt;  |  &lt;a href=&quot;#观察者模式&quot;&gt;观察者模式&lt;/a&gt;&lt;/center&gt;</p>
<p>&lt;br&gt;</p>
<h3>&lt;font name=&quot;策略模式&quot;&gt;策略模式&lt;/font&gt;</h3>
<p>将一组特定的程序或算法封装成类，以适应某些特定的上下文环境;
一个情景过程：</p>
<h6>1.Joe做了一套相当成功的模拟鸭子的游戏。设计了一个超类Duck,然后让各种鸭子继承这个类。</h6>
<h6>2.后来客户提出要让鸭子有飞的能力。所以Joe就在超类中加了个fly()方法，这样下面的子类都有飞行的行为。</h6>
<h6>问题来了：1&gt;原来Duck的子类中竟然有橡皮鸭，橡皮鸭是不会飞的。——Joe用重载的方式，把橡皮鸭的fly()方法设置为空.</h6>
<h6>2&gt;覆盖fly()，我们看到了橡皮鸭的fly()里，没有任何代码，如果以后我们再添加别的不会飞的鸭子，那我么还要这么处理吗?——那么代码重复了!</h6>
<h6>3.上面2的方式我们知道是有问题的，所以Joe想到把Duck做成接口，这样每个子类必须实现Duck里的方法。这样就保证每个鸭子都能根据自己的需要添加行为。</h6>
<h6>问题来了：产品经常处于更新中，规格也在不断的变化。导致每当有新鸭子的时候，Joe就要被迫检查一遍子类是否覆盖了fly()方法。——当你修改某个行为的时候，你必须得往下追踪并在每一个定义此行为的类中修改它。</h6>
<h6>4.综合以上问题，Joe想到了把那些变化的部分从不变化的位置中抽出来。比如，我们对fly()行为，做了单独的接口FlyBehavior。如果鸭子想要飞行功能的时候，我们就让鸭子实现FlyBehavior.</h6>
<h6>5.深造:我们想让鸭子有不同的飞行功能，让它在运行时候做不同的飞行动作。让鸭子类实现接口，只能让鸭子有一种行为。</h6>
<p>所以Joe，想到用组合的防止，当鸭子需要其他飞行功能要求的时候，我们可以用setBehavior()方式，指定性的飞行方式。</p>
<h4>一下为代码：</h4>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">FlyBehavior</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fly</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlyWithWings</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fly</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Fly With Wings \n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlyWithNo</span> <span class="keyword">implements</span> <span class="title">FlyBehavior</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fly</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Fly With No Wings \n"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Duck</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_flyBehavior;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">performFly</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_flyBehavior-&gt;fly();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setFlyBehavior</span><span class="params">(FlyBehavior $behavior)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_flyBehavior = $behavior;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RubberDuck</span> <span class="keyword">extends</span> <span class="title">Duck</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Test Case</span></span><br><span class="line">$duck = <span class="keyword">new</span> RubberDuck();</span><br><span class="line"> </span><br><span class="line"><span class="comment">/*  想让鸭子用翅膀飞行 */</span></span><br><span class="line">$duck-&gt;setFlyBehavior(<span class="keyword">new</span> FlyWithWings());</span><br><span class="line">$duck-&gt;performFly();            </span><br><span class="line"> </span><br><span class="line"><span class="comment">/*  想让鸭子不用翅膀飞行 */</span></span><br><span class="line">$duck-&gt;setFlyBehavior(<span class="keyword">new</span> FlyWithNo());</span><br><span class="line">$duck-&gt;performFly();</span><br></pre></td></tr></table></figure></p>
<p>&lt;br&gt;</p>
<h3>&lt;font name=&quot;观察者模式&quot;&gt;观察者模式&lt;/font&gt;</h3>

      
    </div>
    <footer class="article-footer">
      <a data-url="jiweii.com/2017/01/08/php设计模式浅析-二/" data-id="cjvdqd6w9001zo4r3rme8oi7m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-php设计模式浅析-一" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/07/php设计模式浅析-一/" class="article-date">
  <time datetime="2017-01-07T04:45:16.000Z" itemprop="datePublished">2017-01-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/php/">php</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/07/php设计模式浅析-一/">php设计模式浅析(一)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>php框架及扩展程序中都拥有肯多设计模式，熟练掌握这些设计模式，可以更好的提升编程技巧，知道在那些场景下用什么样的模式设计程序会更合理、稳定， 坚持代码设计的“开·闭”原则，即对扩展开放，对修改关闭，实现程序设计的“高内聚，低耦合”；&lt;!--more--&gt;
&lt;center&gt;直达快车   &lt;a href=&quot;#工厂模式&quot;&gt;工厂模式&lt;/a&gt;  |  &lt;a href=&quot;#单例模式&quot;&gt;单例模式&lt;/a&gt;  |  &lt;a href=&quot;#注册树模式&quot;&gt;注册树模式&lt;/a&gt;  |  &lt;a href=&quot;#适配器模式&quot;&gt;适配器模式&lt;/a&gt;&lt;/center&gt;</p>
<p>&lt;br&gt;</p>
<h3>&lt;font name=&quot;工厂模式&quot;&gt;工厂模式&lt;/font&gt;</h3>
<p>简单的说工厂模式就是把 new 一个对象的操作封装到工厂类的方法中，当一个类被多处使用并需要修改类名、参数等时，只需去工厂类的方法中修改即可。
工厂模式是更多设计模式中使用的基础模式。</p>
<h5><em>代码为工厂模式</em></h5>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Test/Factory.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Database();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Test/test.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//$db = new Database();</span></span><br><span class="line">$db = Test\Factory::createDatabase(); <span class="comment">//工厂模式调用</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&lt;br&gt;</p>
<h3>&lt;font name=&quot;单例模式&quot;&gt;单例模式&lt;/font&gt;</h3>
<p>单例模式是连接数据库、资源中常用的设计模式；
这种类会实现连接到数据库，如果每次都直接实例化会创建很多对数据库的连接，造成资源浪费，使用单例模式只需要创建一个连接即可；</p>
<h5><em>以下代码为前两种模式整合到一起</em></h5>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Db/Database.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Db</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> $db;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">//创建私有的构造方法，防止在类外直接new</span></span><br><span class="line">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">self</span>::$db)&#123;</span><br><span class="line">			<span class="keyword">self</span>::$db = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">self</span>::$db;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Test/Factory.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$db = Db\Database::getInstance();</span><br><span class="line">		<span class="keyword">return</span> $db;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Test/Test.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$db = Test\Factory::createDatabase();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&lt;br&gt;</p>
<h3>&lt;font name=&quot;注册树模式&quot;&gt;注册树模式&lt;/font&gt;</h3>
<p>注册树模式是将对象实例注册到一棵对象树上，需要的时候直接从对象树上获取的一种设计，就像卖糖葫芦，糖葫芦都被插到一个树上，买的时候直接拿，但注册树的拿完了还会存在；
单例模式解决了如何在整个项目中创建唯一对象的问题，工厂模式解决了如何不通过new来实例对象的扩展维护问题，注册数则是把他们整合到一起，方便统筹管理；</p>
<h5><em>以下代码为前三种模式整合到一起</em></h5>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Db/Database.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Db</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Database</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> $db;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="keyword">self</span>::$db)&#123;</span><br><span class="line">			<span class="keyword">self</span>::$db = <span class="keyword">new</span> <span class="keyword">self</span>();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">self</span>::$db;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Test/Factory.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">createDatabase</span><span class="params">()</span></span>&#123;</span><br><span class="line">		$db = Db\Database::getInstance();</span><br><span class="line">		Test\Register::set(<span class="string">'db'</span>, $db);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Test/Register.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Register</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> $objects;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span><span class="params">($alias, $object)</span></span>&#123;</span><br><span class="line">		<span class="keyword">self</span>::$objects[$alias] = $object;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">($alias)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">self</span>::$objects[$alias];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">_unset</span><span class="params">($alias)</span></span>&#123;</span><br><span class="line">		<span class="keyword">unset</span>(<span class="keyword">self</span>::$objects[$alias]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Test/test.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$db = Test\Register::get(<span class="string">'db'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>&lt;br&gt;</p>
<h3>&lt;font name=&quot;适配器模式&quot;&gt;适配器模式&lt;/font&gt;</h3>
<p>核心思想：把对某些相似的类的操作转化为一个统一的“接口”，适配器构造了一种机制，使“适配”的类可以很容易的增减，而不用修改与适配器交互的代码，符合“减少代码间耦合”的设计原则。</p>
<h5><em>以下代码为一个博友解决了一个奇葩情景所设计适配器模式，此处为只摘取最终版本原代码，具体情景如下:</em></h5>
<h5><em>一开始的和谐</em></h5>
<h6>黑枣玩具公司专门生产玩具，生产的玩具不限于狗、猫、狮子，鱼等动物。每个玩具都可以进行“张嘴”与“闭嘴”操作，分别调用了openMouth与closeMouth方法。在这个时候，我们很容易想到可以第一定义一个抽象类Toy,甚至是接口Toy,这些问题不大，其他的类去继承父类，实现父类的方法。一片和谐，信心向荣。</h6>
<h5><em>平衡的破坏</em></h5>
<h6>为了扩大业务，现在黑枣玩具公司与红枣遥控公司合作，红枣遥控公司可以使用遥控设备对动物进行嘴巴控制。不过红枣遥控公司的遥控设备是调用的动物的doMouthOpen及doMouthClose方法。黑枣玩具公司的程序员现在必须要做的是对Toy系列类进行升级改造，使Toy能调用doMouthOpen及doMouthClose方法。</h6>
<h5><em>更加烦躁</em></h5>
<h6>程序员刚刚码完代码，喝了口水，突然间另一个消息传来。</h6>
<h6>黑枣玩具公司也要与绿枣遥控公司合作，因为绿枣遥控公司遥控设备更便宜稳定。不过绿枣遥控公司的遥控设备是调用的动物的operMouth(type)方法来实现嘴巴控制。如果type)方法来实现嘴巴控制。如果type为0则“闭嘴”，反之张嘴。</h6>
<p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Toy</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">openMouth</span><span class="params">()</span></span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">closeMouth</span><span class="params">()</span></span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Toy</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">openMouth</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Dog open Mouth\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">closeMouth</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Dog close Mouth\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Toy</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">openMouth</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Cat open Mouth\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">closeMouth</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Cat close Mouth\n"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//目标角色:红枣遥控公司  </span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">RedTarget</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doMouthOpen</span><span class="params">()</span></span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doMouthClose</span><span class="params">()</span></span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//目标角色:绿枣遥控公司及  </span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">GreenTarget</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">operateMouth</span><span class="params">($type = <span class="number">0</span>)</span></span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//类适配器角色:红枣遥控公司  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedAdapter</span> <span class="keyword">implements</span> <span class="title">RedTarget</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> $adaptee;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Toy $adaptee)</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;adaptee = $adaptee;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//委派调用Adaptee的sampleMethod1方法  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doMouthOpen</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;adaptee-&gt;openMouth();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">doMouthClose</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;adaptee-&gt;closeMouth();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//类适配器角色:绿枣遥控公司  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GreenAdapter</span> <span class="keyword">implements</span> <span class="title">GreenTarget</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> $adaptee;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Toy $adaptee)</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">$this</span>-&gt;adaptee = $adaptee;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">//委派调用Adaptee：GreenTarget的operateMouth方法  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">operateMouth</span><span class="params">($type = <span class="number">0</span>)</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> ($type) &#123;  </span><br><span class="line">            <span class="keyword">$this</span>-&gt;adaptee-&gt;openMouth();  </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="keyword">$this</span>-&gt;adaptee-&gt;closeMouth();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">testDriver</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">         <span class="comment">//实例化一只狗玩具  </span></span><br><span class="line">        $adaptee_dog = <span class="keyword">new</span> Dog();  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"给狗套上红枣适配器\n"</span>;  </span><br><span class="line">        $adapter_red = <span class="keyword">new</span> RedAdapter($adaptee_dog);  </span><br><span class="line">        <span class="comment">//张嘴  </span></span><br><span class="line">        $adapter_red-&gt;doMouthOpen();  </span><br><span class="line">        <span class="comment">//闭嘴  </span></span><br><span class="line">        $adapter_red-&gt;doMouthClose();  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"给狗套上绿枣适配器\n"</span>;  </span><br><span class="line">        $adapter_green = <span class="keyword">new</span> GreenAdapter($adaptee_dog);  </span><br><span class="line">        <span class="comment">//张嘴  </span></span><br><span class="line">        $adapter_green-&gt;operateMouth(<span class="number">1</span>);  </span><br><span class="line">        <span class="comment">//闭嘴  </span></span><br><span class="line">        $adapter_green-&gt;operateMouth(<span class="number">0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">$test = <span class="keyword">new</span> testDriver();  </span><br><span class="line">$test-&gt;run();</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="jiweii.com/2017/01/07/php设计模式浅析-一/" data-id="cjvdqd6w5001wo4r35xi4c5yo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/php/">php</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/privately/">privately</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/">nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/php/">php</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/privately/">privately</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/nginx/" style="font-size: 20px;">nginx</a> <a href="/tags/php/" style="font-size: 16.67px;">php</a> <a href="/tags/privately/" style="font-size: 13.33px;">privately</a> <a href="/tags/数据库/" style="font-size: 13.33px;">数据库</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/05/05/面试题/">面试题</a>
          </li>
        
          <li>
            <a href="/2019/04/04/常用书籍、资料、手册/">常用书籍、资料、手册</a>
          </li>
        
          <li>
            <a href="/2018/10/20/常用/">常用 [置顶]</a>
          </li>
        
          <li>
            <a href="/2018/10/19/课程链接/">个人加密</a>
          </li>
        
          <li>
            <a href="/2018/08/07/13-nginx/">(13)正则、如何找server指令块</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Jiwei<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"live2d-widget-model-wanko    //妹子有很多个，叫名字他才出来"},"display":{"position":"right   //位置","width":"150    //妹子宽度","height":"300    //妹子高度"},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>